\section{Recipes - Steps to Solve Common Tasks}

\subsection{1. System Analysis \& DoF Counting (General/Legged Systems)}
\textbf{Start every problem with this to identify underactuation and
constraints (extends legged.tex DoF concepts).}
\begin{itemize}
  \item \textbf{Generalized Coordinates ($n$)}: Size of $q$ (e.g.,
      fixed base: $n = n_{joints}$; 3D floating base: $n = 6 +
    n_{joints}$; planar: $n = 3 + n_{joints}$).
  \item \textbf{Constraints ($n_c$)}: Per contact (e.g., point
    no-slip: 3 in 3D, 2 in 2D; surface: 6 in 3D).
  \item \textbf{Uncontrollable DoFs}: $\dim(\text{Base}) -
    \text{rank}(J_{contact})$ (e.g., planar base with 1 point contact:
    $3 - 2 = 1$ uncontrollable).
  \item \textbf{Controllable DoFs}: Total $n - n_c$ (subtract
    unactuated base if underactuated).
\end{itemize}

\subsection{2. Geometric Jacobian Derivation (Serial Chains)}
\textbf{To relate $\dot{q}$ to end-effector twist (merges both lists;
extends kinematics.tex with step-by-step construction).}
\begin{itemize}
  \item Assign DH parameters/frames.
  \item For revolute joint $i$: $J_{P,i} = z_{i-1} \times (r_E -
    r_{i-1})$, $J_{R,i} = z_{i-1}$.
  \item For prismatic: $J_{P,i} = z_{i-1}$, $J_{R,i} = 0$.
  \item Total $J =
    \begin{bmatrix} J_P \\ J_R
    \end{bmatrix}$.
  \item Singularity: $\det(J J^T)=0$; manipulability $\mu = \sqrt{\det(J J^T)}$.
\end{itemize}

\subsection{3. Inverse Kinematics (Velocity Level, Single/Multi-Task)}
\textbf{To find $\dot{q}$ for desired task velocity (merges both
lists; extends kinematics.tex with hierarchical details).}
\begin{itemize}
  \item Single task: $\dot{q} = J^{\dagger} v_{task}$.
  \item Hierarchical (null-space): Primary $J_1, v_1$: $\dot{q} =
    J_1^{\dagger} v_1 + (I - J_1^{\dagger} J_1) \dot{q}_{null}$,
    where $\dot{q}_{null} = J_2^{\dagger} (v_2 - J_2 J_1^{\dagger} v_1)$.
  \item Multi-task: $\dot{q} = \sum N_i \dot{q}_i$, $\dot{q}_i = (J_i
    N_i)^+ (v_i^* - J_i \sum_{k<i} \dot{q}_k)$.
  \item Near singularity: Damped LS $J^* = J^T (JJ^T + \lambda I)^{-1}$.
\end{itemize}

\subsection{4. Derive EoM (Lagrange for Fixed-Base Arms)}
\textbf{For 2R/3R manipulators (from List 1; extends dynamics.tex
with explicit computation steps).}
\begin{itemize}
  \item Kinetic $T = \sum \frac{1}{2} m_i v_i^2 + \frac{1}{2}
    \omega_i^T I_i \omega_i$.
  \item Potential $U = \sum m_i g h_i$.
  \item $\frac{d}{dt} (\partial L / \partial \dot{q}_k) - \partial L
    / \partial q_k = \tau_k$ ($L=T-U$).
  \item Compute M, C (Christoffel: $C_{kj} = \frac{1}{2} \sum_i
      (\partial M_{kj}/\partial q_i + \partial M_{ki}/\partial q_j -
    \partial M_{ij}/\partial q_k) \dot{q}_i$), g.
\end{itemize}

\subsection{5. Inverse Dynamics (Joint/Task Space)}
\textbf{To compute $\tau$ for desired motion (from List 2; extends
dynamics.tex with force and task handling).}
\begin{itemize}
  \item Joint space: $\tau = M(q)(\ddot{q}^* + K_p e + K_d \dot{e}) +
    h(q, \dot{q})$ ($h = C\dot{q} + g$).
  \item With external force: $\tau_{total} = \tau_{motion} + J^T F_{ext}$.
  \item Task space: Solve $\ddot{q}_{des} = J^{\dagger}(\ddot{x}^* -
    \dot{J}\dot{q})$, then plug into EoM.
\end{itemize}

\subsection{6. Floating Base Dynamics \& Contact Consistency}
\textbf{For underactuated systems with contacts (from List 2; extends
dynamics.tex and legged.tex with projection steps).}
\begin{itemize}
  \item Full EoM: $M \dot{u} + h = S^T \tau + J_c^T F_c$.
  \item Constraint: $J_c \dot{u} = -\dot{J}_c u$ (no slip).
  \item Projected dynamics: Use projector $P$ ($P J_c^T = 0$): $P(M
    \dot{u} + h) = P S^T \tau$.
  \item Note: Eliminates $F_c$ for feasibility checks.
\end{itemize}

\subsection{7. Hierarchical Optimization (QP) Formulation}
\textbf{For legged/floating-base control (merges both lists; extends
legged.tex and dynamics.tex with matrix setup).}
$\min_{\ddot{q}, \tau, f_c} \|\tau\|^2 + \epsilon \|\ddot{q}\|^2 +
\epsilon \|f_c\|^2$ s.t.\\
- Dynamics: $M \ddot{q} + h = S^T \tau + J_c^T f_c$.\\
- Contact: $J_c \ddot{q} + \dot{J}_c \dot{q} = 0$.\\
- Task (e.g., CoM): $J_{com} \ddot{q} + \dot{J}_{com} \dot{q} =
\ddot{x}_{com}^*$.\\
- Bounds: $|\tau| \leq \tau_{max}$, friction cone $\|f_{c,\perp}\|
\leq \mu f_{c,z}$.\\
\textbf{Matrix form}: Stack into $A x = b$ (e.g., $x = [\dot{u}^T,
\tau^T, F_c^T]^T$).

\subsection{8. Multirotor Control Allocation \& Hover}
\textbf{For quad/hexacopters (merges both lists; extends rotor.tex
with tilt and over-actuated cases).}
\begin{itemize}
  \item Hover: Total $T = mg$, per rotor $\omega_i = \sqrt{T/(4 b)}$ (quad).
  \item Allocation matrix: Solve $A \omega^2 = [T, M_x, M_y, M_z]^T$
    (pseudo-inverse for over-actuated; min $\sum \omega^2$).
  \item Tilt for accel: $\theta_d = \arcsin(a_x / g)$, check drag $D
    \propto \omega^2$.
  \item Yaw signs: Positive $d$ for CCW rotors (CW torque on body).
\end{itemize}

\subsection{9. Fixed-Wing Performance \& Steady States}
\textbf{For level flight and turns (merges both lists; extends
wing.tex with optimal velocities and safety checks).}
\begin{itemize}
  \item Steady level: $L = mg$, $T = D = \frac{1}{2} \rho v^2 S C_D$;
    $C_L = \frac{2mg}{\rho v^2 S}$.
  \item Optimal: Max range at max $C_L/C_D$; max endurance at max
    $C_L^{1.5}/C_D$; gliding angle $\tan \gamma = (L/D)^{-1}$.
  \item Coordinated turn: $\tan \phi = \frac{v^2}{g R}$, load
    $n=1/\cos\phi$; required $C_L = n (2 m g / (\rho v^2 S))$.
  \item Safety: $C_L < C_{L,max}$ (stall check); min $R$ at max bank
    without stall.
\end{itemize}

