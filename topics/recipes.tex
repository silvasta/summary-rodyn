\section{Recipes - Steps to Solve Common Tasks}

\subsection{Kinematics}

Consider a 2D mobile manipulator robot with a wheeled base
(horizontal position $x_b$), a prismatic joint for height ($z_l$),
and a 3-joint arm ($\phi_1, \phi_2, \phi_3$).
Links have lengths
$l_1, l_2, l_3$.
\\
Generalized coordinates: $q = (x_b, z_l, \phi_1,
\phi_2, \phi_3)^T$.

\begin{enumerate}
  \item Write the forward kinematics for the end-effector position
    $r_e = (x_e, z_e)^T$ in the world frame.

  \item Derive the geometric Jacobian $J_e(q)$ for the
    end-effector linear velocity.

  \item Provide a singular configuration and explain the lost
    degree of freedom.

  \item For a desired end-effector velocity $v_e^* = (1, 0)^T$
    m/s, compute the minimal-norm joint velocity $\dot{q}^*$ using
    pseudoinverse (assume non-singular $q$).

  \item The system is redundant. Formulate a multi-task control
    where primary task is $v_e^*$ and secondary task is to keep
    $\dot{\phi_1} = 0$ and $\dot{z_l} = 0$. Use null-space projection for
    equal priority.

  \item If secondary task has higher priority, how would you
    modify the control law?

  \item Discuss how to handle singularities using damped least-squares.
\end{enumerate}

\subsubsection{Solution}
\begin{enumerate}
  \item
    $x_e = x_b + l_1 \cos\phi_1 + l_2 \cos(\phi_1 + \phi_2) + l_3
    \cos(\phi_1 + \phi_2 + \phi_3)$

    $z_e = z_l + l_1 \sin\phi_1 + l_2 \sin(\phi_1 + \phi_2) + l_3
    \sin(\phi_1 + \phi_2 + \phi_3)$
  \item $J_e =\left[
      \begin{matrix}
        1 & 0 \\ 0 & 1
      \end{matrix}\right $

      $
      \left
      \begin{matrix}
        -l_1 s_1 - l_2 s_{12} - l_3 s_{123} & -l_2 s_{12} - l_3
        s_{123} & -l_3 s_{123} \\
        l_1 c_1 + l_2 c_{12} + l_3 c_{123} & l_2 c_{12} + l_3 c_{123}
        & l_3 c_{123}
    \end{matrix}\right]
    $
    \\
    (where $s_1 = \sin\phi_1$, etc.)

  \item E.g., $\phi_2 = \phi_3 = 0$, arm fully extended; loses control in
    radial direction.

  \item $\dot{q}^* = J_e^+ v_e^*$, where $J_e^+ = J_e^T (J_e J_e^T)^{-1}$.

  \item Stacked Jacobian $J =
    \begin{bmatrix} J_e \\ J_{sec}
    \end{bmatrix}$, where \\
    $J_{sec} =
    \begin{bmatrix} 0 & 0 & 1 & 0 & 0 \\ 0 & 1 & 0 & 0 & 0
    \end{bmatrix}$, desired $\dot{q}^* = J^+
    \begin{bmatrix} v_e^* \\ 0
    \end{bmatrix}$

  \item Prioritize secondary:\\
    $\dot{q}^* = J_{sec}^+ 0 + N_{sec} J_e^+
    (v_e^* - J_e J_{sec}^+ 0)$,\\
    where $N_{sec} = I - J_{sec}^+ J_{sec}$.

  \item Use damped pseudoinverse $J^+ = J^T (J J^T + \lambda I)^{-1}$ to
    avoid high velocities near singularities.
\end{enumerate}

\subsection{Dynamics}

The equations of motion are $M(q) \ddot{q} + C(q, \dot{q}) \dot{q} +
g(q) = \tau$.

1.  Derive a joint-space PD controller with gravity
compensation for tracking $q^*$.

2.  Formulate an inverse dynamics control law for desired
acceleration $\ddot{q}^*$.

3.  For a floating-base version (add base orientation
$\theta_b$), explain why $M$ is not full rank.

4.  Propose a task-space impedance controller for end-effector
force tracking.

5.  Discuss redundancy resolution in torque space for
over-actuated systems.
\subsubsection{Solution}

1. $\tau = g(q) + K_p (q^* - q) - K_d \dot{q}$.

2. $\tau = M \ddot{q}^* + C \dot{q} + g$.

3. Floating base has unactuated DOFs (linear momentum conservation);
$M$ has rank deficiency.

4. $\tau = J_e^T (K_p \Delta r_e - K_d v_e + f^*) + g$, where $\Delta
r_e = r_e^* - r_e$.

5. Use null space: $\tau = \tau_{task} + N \tau_0$, where $N = I -
J^+ J$, $\tau_0$ optimizes secondary objectives like joint limits.

\subsection{Legged Robots}

Consider a quadruped with 3 DOF per leg, point feet, two feet in contact.

1. (3 pts) What is the dimension of the null space for joint torques?

2. (4 pts) Formulate the contact-consistent dynamics and how to
project accelerations.

3. (3 pts) Describe a simple balance controller using CoM projection.
\subsubsection{Solution}

1. Total DOF: 6 (floating base) + 12 (joints) = 18\\
constraints: 2 feet Ã— 3 = 6; null space dim = 18 - (18 - 6) = 6 \\
(redundancy in torque)

2. $M \ddot{q} + h = S \tau + J_c^T \lambda$
\\project to consistent
$\ddot{q} = (I - J_c^+ J_c) \ddot{q}_0 + J_c^+ \dot{J_c} \dot{q}$

3. Control torques to keep projected CoM within support polygon,
e.g., via virtual model control.

\subsection{Rotorcraft}

For a quadcopter.

1. (3 pts) Write the thrust allocation for position control.

2. (3 pts) Explain coupling between position and attitude.

3. (2 pts) Why are feedforward terms useful in tracking?
\subsubsection{Solution}

1. Total thrust $f = m (\ddot{z}^* + g)$, moments from differential
rotor speeds.

2. Underactuated: attitude must tilt to generate horizontal forces.

3. Compensate nonlinearities for better tracking without relying
solely on feedback.

\subsection{Fixed-Wing Aircraft}

For a fixed-wing UAV in level flight.

1. (3 pts) Derive the required bank angle for a coordinated turn of
radius R at speed V.

2. (2 pts) How does wind affect guidance?

3. (2 pts) Explain airspeed vs. groundspeed in control.

\subsubsection{Solution}

1. $\phi = \tan^{-1}(V^2 / (g R))$.

2. Wind disturbs position; guidance uses groundspeed feedback for correction.

3. Airspeed for aerodynamic stability, groundspeed for navigation.

